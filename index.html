<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Datos api</title>
  <style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --muted:#666;
    --accent:#0b76ef;
    --radius:8px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{
    margin:0;
    padding:24px;
    background:var(--bg);
    color:#111;
  }
  .container{
    max-width:1100px;
    margin:0 auto;
  }
  header{margin-bottom:18px}
  h1{font-size:20px;margin:0 0 6px}
  #productos{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
    gap:16px;
  }
  .card{
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:0 1px 6px rgba(12,20,30,0.06);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    min-height:220px;
  }
  .thumb{
    width:100%;
    height:160px;
    object-fit:cover;
    background:#eee;
  }
  .card-body{
    padding:12px;
    flex:1;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .meta{font-size:13px;color:var(--muted)}
  .title{font-weight:600;font-size:15px;margin:0}
  .precio{color:var(--accent);font-weight:700}
  .desc{font-size:13px;color:#333;display:none;margin-top:8px}
  .desc.open{display:block}
  .controls{margin-top:auto;display:flex;gap:8px;align-items:center;justify-content:space-between}
  button{
    border:0;padding:8px 10px;border-radius:6px;background:#0b76ef;color:#fff;cursor:pointer;
  }
  .error{color:#b00020;background:#fff0f0;padding:10px;border-radius:6px}
  .loading{color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Productos</h1>
      <div id="status" class="loading">Cargando...</div>
    </header>

    <main id="productos" aria-live="polite">
      <!-- tarjetas se insertan aquí -->
    </main>
  </div>

  <script>
  (async function(){
    const API = 'https://localhost:7019/api/Producto';
    const root = document.getElementById('productos');
    const status = document.getElementById('status');

    function setStatus(text){
      status.textContent = text || '';
      status.className = text ? 'loading' : '';
    }

    function escapeHtml(s){
      return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    setStatus('Cargando...');
    try {
      const res = await fetch(API, { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      if (!Array.isArray(data) || data.length === 0) {
        root.innerHTML = '<p>No hay productos disponibles.</p>';
        setStatus('');
        return;
      }

      root.innerHTML = data.map(p => `
        <article class="card">
          <img class="thumb" src="${p.imagen}" alt="${escapeHtml(p.nombre)}"
               
          <div class="card-body">
            <h2 class="title">${escapeHtml(p.nombre)}</h2>
            ${p.artista ? `<div class="meta">${escapeHtml(p.artista)}</div>` : ''}
            ${p.genero  ? `<div class="meta">${escapeHtml(p.genero)}</div>`  : ''}
            ${p.unidades? `<div class="meta">${escapeHtml(p.unidades)}</div>`: ''}
            <div class="controls">
              <div class="precio">${escapeHtml(p.precio)}</div>
              <button type="button" class="toggle-desc">Ver descripción</button>
            </div>
            <div class="desc">${escapeHtml(p.descripcion)}</div>
          </div>
        </article>
      `).join('');

      // añadir comportamiento para mostrar/ocultar descripciones
      root.querySelectorAll('.toggle-desc').forEach(btn => {
        btn.addEventListener('click', () => {
          const desc = btn.closest('.card').querySelector('.desc');
          const open = desc.classList.toggle('open');
          btn.textContent = open ? 'Ocultar descripción' : 'Ver descripción';
        });
      });

      setStatus('');
    } catch (err) {
      root.innerHTML = '';
      status.className = 'error';
      status.textContent = 'Error al cargar los productos.';
      console.error(err);
    }
  })();
  </script>
</body>
</html>